<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>GOALSTORM! â€” FREE KICK</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
<style>
:root{ --bg:#0f0e17; --neon-pink:#ff2a6d; --neon-cyan:#05d9e8; --neon-yellow:#ffc800; }
body{ background:var(--bg); color:#fff; font-family:"VT323"; display:flex; flex-direction:column; align-items:center; min-height:100vh; margin:0; }

.panel {
    width: 95%; max-width: 600px; background: #1a1a2e;
    border: 3px solid var(--neon-cyan); padding: 15px; margin-top: 20px;
    box-shadow: 0 0 20px rgba(5, 217, 232, 0.2);
}

h1 { font-family:"Press Start 2P"; font-size:20px; color:var(--neon-yellow); text-align:center; margin-bottom:15px; }

/* GAME CANVAS */
.game-container { position:relative; width:100%; height:300px; background:#1e5631; border:2px solid #fff; overflow:hidden; }

/* HUD OVERLAYS */
.hud { position:absolute; top:10px; left:10px; font-size:18px; z-index:10; text-shadow:1px 1px #000; pointer-events:none;}

/* POWER BAR */
.power-wrapper {
    position:absolute; bottom:10px; left:10px; right:10px; height:20px;
    background:#000; border:2px solid #555; display:none;
}
.power-fill { height:100%; width:0%; background:linear-gradient(90deg, var(--neon-cyan), var(--neon-pink)); }

/* CONTROLS */
button {
    width:100%; padding:20px; font-family:"Press Start 2P"; font-size:16px;
    background:var(--neon-pink); color:#fff; border:none; border-bottom:5px solid #900;
    cursor:pointer; margin-top:10px;
}
button:active { transform:translateY(4px); border-bottom:1px solid #900; }
</style>
</head>
<body>

<div class="panel">
    <h1>TRAJECTORY TITAN</h1>
    <div style="text-align:center; margin-bottom:10px; color:#aaa;">TAP TO LOCK ANGLE &rarr; TAP TO LOCK POWER</div>
    
    <div class="game-container" id="gameBox">
        <canvas id="canvas" width="600" height="300"></canvas>
        <div class="hud" id="hud">WIND: <span id="windVal">0</span></div>
        <div class="power-wrapper" id="pwrBar"><div class="power-fill" id="pwrFill"></div></div>
    </div>

    <button id="actionBtn" onclick="handleInput()">START TARGETING</button>
</div>

<script>
const cvs = document.getElementById('canvas');
const ctx = cvs.getContext('2d');
const btn = document.getElementById('actionBtn');
const pwrBar = document.getElementById('pwrBar');
const pwrFill = document.getElementById('pwrFill');
const windDisplay = document.getElementById('windVal');

// GAME STATE
let state = 'IDLE'; // IDLE, ANGLE, POWER, SHOOTING, END
let ball = { x: 50, y: 270, r: 6, vx: 0, vy: 0 };
let arrow = { angle: 0, dir: 1 }; // For angle selection
let power = 0;
let powerDir = 1;
let wind = (Math.random() * 2 - 1).toFixed(1); // Random wind -1 to 1

// CONFIG
const WALL_X = 300;
const WALL_H = 100; // Height of defenders
const GOAL_X = 500;
const GOAL_W = 15; // Width of goal line (top down view logic applied to side view)
const GRAVITY = 0.25;

// RESIZE CANVAS
function resize() {
    // Keep internal resolution but scale visuals
    const rect = document.getElementById('gameBox').getBoundingClientRect();
    cvs.width = rect.width;
    cvs.height = rect.height;
    resetBall();
}
window.onload = resize;

function resetBall() {
    ball.x = 40; 
    ball.y = cvs.height - 20;
    wind = (Math.random() * 1.5 - 0.75).toFixed(2); // New wind
    windDisplay.innerText = wind;
    windDisplay.style.color = wind > 0 ? '#05d9e8' : '#ff2a6d';
}

// MAIN LOOP
function loop() {
    ctx.clearRect(0,0,cvs.width,cvs.height);

    // 1. DRAW SCENE
    // Ground
    ctx.fillStyle = "#164023";
    ctx.fillRect(0, cvs.height-10, cvs.width, 10);

    // Wall (Defenders)
    ctx.fillStyle = "#ff2a6d";
    ctx.fillRect(WALL_X, cvs.height - 10 - WALL_H, 20, WALL_H);
    ctx.fillStyle = "#fff"; // Heads
    ctx.beginPath(); ctx.arc(WALL_X+10, cvs.height - 10 - WALL_H, 10, 0, Math.PI*2); ctx.fill();

    // Goal
    ctx.fillStyle = "#fff";
    ctx.fillRect(cvs.width - 60, cvs.height - 110, 5, 100); // Post
    ctx.strokeStyle = "#fff"; ctx.lineWidth=2;
    ctx.beginPath(); // Net
    ctx.moveTo(cvs.width - 60, cvs.height - 110);
    ctx.lineTo(cvs.width - 10, cvs.height - 10);
    ctx.stroke();

    // 2. STATE LOGIC
    if (state === 'ANGLE') {
        // Oscillate Arrow
        arrow.angle += 1 * arrow.dir;
        if(arrow.angle > 80) arrow.dir = -1;
        if(arrow.angle < 10) arrow.dir = 1;
        
        drawArrow(ball.x, ball.y, arrow.angle, 60, '#ffc800');
    } 
    else if (state === 'POWER') {
        // Freeze Arrow, Oscillate Power
        drawArrow(ball.x, ball.y, arrow.angle, 60, '#555'); // Ghost arrow
        
        power += 2 * powerDir;
        if(power > 100) powerDir = -1;
        if(power < 0) powerDir = 1;
        
        pwrFill.style.width = power + "%";
    }
    else if (state === 'SHOOTING') {
        // Physics
        ball.vx -= parseFloat(wind) * 0.02; // Wind Resistance
        ball.vy += GRAVITY; // Gravity
        
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Collision: Floor
        if(ball.y > cvs.height - 15) {
            state = 'END';
            checkWin();
        }

        // Collision: Wall
        if (ball.x > WALL_X && ball.x < WALL_X + 20 && ball.y > cvs.height - 10 - WALL_H) {
             ball.vx *= -0.5; // Bounce back
             state = 'END';
             btn.innerText = "BLOCKED! RESET?";
             btn.style.background = "#ff2a6d";
        }
    }

    // Draw Ball
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fillStyle = "#fff"; ctx.fill();
    ctx.strokeStyle = "#000"; ctx.stroke();

    requestAnimationFrame(loop);
}

function drawArrow(x, y, ang, len, color) {
    const rad = ang * Math.PI / 180;
    const endX = x + len * Math.cos(-rad);
    const endY = y + len * Math.sin(-rad);
    
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(endX, endY);
    ctx.strokeStyle = color;
    ctx.lineWidth = 4;
    ctx.stroke();
}

// INPUT HANDLER
function handleInput() {
    if (state === 'IDLE' || state === 'END') {
        state = 'ANGLE';
        resetBall();
        btn.innerText = "LOCK ANGLE";
        btn.style.background = "#05d9e8";
        btn.style.color = "#000";
        pwrBar.style.display = "none";
    } 
    else if (state === 'ANGLE') {
        state = 'POWER';
        btn.innerText = "LOCK POWER";
        btn.style.background = "#ffc800";
        pwrBar.style.display = "block";
    } 
    else if (state === 'POWER') {
        state = 'SHOOTING';
        btn.innerText = "SHOOTING...";
        btn.style.background = "#555";
        btn.style.color = "#fff";
        
        // Calculate Velocity
        const rad = arrow.angle * Math.PI / 180;
        const speed = power * 0.18; // Multiplier to tune speed
        
        ball.vx = speed * Math.cos(-rad);
        ball.vy = speed * Math.sin(-rad);
    }
}

function checkWin() {
    // Did it land in the goal area?
    // Goal is between x=cvs.width-60 and cvs.width
    if (ball.x > cvs.width - 60 && ball.x < cvs.width) {
        btn.innerText = "GOAL!!! (+10 PTS)";
        btn.style.background = "#05d9e8"; // Success Cyan
    } else {
        btn.innerText = "MISSED. TRY AGAIN.";
        btn.style.background = "#ff2a6d"; // Fail Pink
    }
}

// Start
loop();
</script>
</body>
</html>
