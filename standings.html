<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>GOALSTORM! ‚Äî BONUS MODULES</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
<style>
/* --- CORE PALETTE --- */
:root{
  --bg: #0f0e17;          
  --neon-pink: #ff2a6d;   
  --neon-cyan: #05d9e8;   
  --neon-yellow: #ffc800; 
  --panel: #1a1a2e;
}

*{box-sizing:border-box;margin:0;padding:0;}
body{
    background-color: var(--bg);
    color: #d1d1d1; font-family:"VT323", monospace;
    display:flex; flex-direction:column; align-items:center;
    min-height: 100vh; padding: 20px;
}

h1 {
    font-family: "Press Start 2P"; font-size: 16px; color: var(--neon-cyan);
    margin-bottom: 20px; border-bottom: 4px solid #000; padding-bottom:10px;
}

.panel {
    width: 100%; max-width: 500px; background: var(--panel);
    border: 3px solid var(--neon-cyan); padding: 20px; margin-bottom: 40px;
    box-shadow: 0 0 20px rgba(5, 217, 232, 0.1);
}

/* --- MODULE 1: SCRATCHPAD STYLES --- */
.scratch-container {
    position: relative;
    width: 300px; height: 150px;
    margin: 0 auto;
    border: 4px solid #fff;
    box-shadow: 4px 4px 0 var(--neon-pink);
    user-select: none;
}

/* The Hidden Prize Layer */
.scratch-prize {
    position: absolute; inset: 0;
    background: repeating-linear-gradient(45deg, #111, #111 10px, #222 10px, #222 20px);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 1;
}
.prize-text {
    font-family: "Press Start 2P"; font-size: 18px; color: var(--neon-yellow);
    text-shadow: 2px 2px #000; text-align: center; line-height: 1.5;
}

/* The Canvas Cover Layer */
canvas.scratch-canvas {
    position: absolute; inset: 0;
    z-index: 2; cursor: crosshair;
    touch-action: none; /* Prevent scrolling on mobile while scratching */
}

/* --- MODULE 2: SLOT MACHINE STYLES --- */
.slot-machine {
    display: flex; justify-content: center; gap: 10px;
    background: #000; padding: 15px; border: 2px solid #333;
    margin-bottom: 15px;
}

.reel {
    width: 80px; height: 100px;
    background: #fff;
    border: 4px solid #000;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
}

.reel-strip {
    position: absolute; top: 0; left: 0; width: 100%;
    /* No transition by default to allow infinite loop effect */
}

.reel-icon {
    width: 100%; height: 100px;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px; border-bottom: 1px solid #ccc;
}

.spin-btn {
    width: 100%; padding: 15px;
    background: var(--neon-yellow); color: #000;
    font-family: "Press Start 2P"; border: none; cursor: pointer;
    box-shadow: 4px 4px 0 #fff; transition: transform 0.1s;
}
.spin-btn:active { transform: translate(2px,2px); box-shadow: 2px 2px 0 #fff; }
.spin-btn:disabled { background: #555; box-shadow: none; color: #888; cursor: not-allowed; }

.slot-message {
    text-align: center; margin-top: 15px; font-size: 24px; color: var(--neon-cyan); height: 30px;
}

/* Icons for Slots (Using Emojis for simplicity, but SVGs work too) */
/* üõ°Ô∏è Defender, üëü Midfielder, ‚öΩ Striker, üü• Red Card */
</style>
</head>
<body>

<div class="panel">
    <h1>TACTICAL SCRATCHPAD</h1>
    <div style="margin-bottom:15px; color:#888;">SCRATCH TO REVEAL YOUR BONUS CONDITION</div>
    
    <div class="scratch-container" id="scratchCard">
        <div class="scratch-prize">
            <div class="prize-text" id="prizeText">???</div>
            <div style="font-size:14px; color:#fff; margin-top:5px;">BONUS APPLIED</div>
        </div>
        <canvas class="scratch-canvas" id="scratchCanvas" width="300" height="150"></canvas>
    </div>
    
    <button class="spin-btn" style="margin-top:20px; background:#333; color:#fff;" onclick="resetScratch()">NEW CARD</button>
</div>

<div class="panel">
    <h1>SQUAD SLOTS</h1>
    <div style="margin-bottom:15px; color:#888;">MATCH 3 ICONS FOR A SCORE MULTIPLIER</div>

    <div class="slot-machine">
        <div class="reel"><div class="reel-strip" id="reel1"></div></div>
        <div class="reel"><div class="reel-strip" id="reel2"></div></div>
        <div class="reel"><div class="reel-strip" id="reel3"></div></div>
    </div>

    <button class="spin-btn" id="slotBtn" onclick="spinSlots()">SPIN REELS</button>
    <div class="slot-message" id="slotResult">READY...</div>
</div>

<script>
/* =========================================
   LOGIC 1: SCRATCH CARD
   ========================================= */
const canvas = document.getElementById('scratchCanvas');
const ctx = canvas.getContext('2d');
const prizeText = document.getElementById('prizeText');
let isDrawing = false;

// 1. Setup the Cover
function initScratch() {
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = '#1a1a2e'; // Dark Blue Cover
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Add "Grid/Pattern" to cover
    ctx.fillStyle = '#05d9e8';
    ctx.font = "20px VT323";
    ctx.textAlign = "center";
    ctx.fillText("/// TACTICAL COVER ///", 150, 75);
    ctx.fillText("SCRATCH HERE", 150, 95);
    
    // Set a random prize
    const prizes = ["DOUBLE POINTS", "IGNORE 1 LOSS", "+50% BONUS", "FREE HIT", "AUTO WIN"];
    prizeText.innerText = prizes[Math.floor(Math.random() * prizes.length)];
}

// 2. Scratch Logic
function scratch(x, y) {
    ctx.globalCompositeOperation = 'destination-out'; // This makes it transparent
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2, false); // Brush size 20
    ctx.fill();
}

// 3. Mouse/Touch Handlers
function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: clientX - rect.left, y: clientY - rect.top };
}

canvas.addEventListener('mousedown', (e) => { isDrawing = true; const p = getPos(e); scratch(p.x, p.y); });
canvas.addEventListener('touchstart', (e) => { isDrawing = true; const p = getPos(e); scratch(p.x, p.y); e.preventDefault(); });
canvas.addEventListener('mousemove', (e) => { if (isDrawing) { const p = getPos(e); scratch(p.x, p.y); } });
canvas.addEventListener('touchmove', (e) => { if (isDrawing) { const p = getPos(e); scratch(p.x, p.y); e.preventDefault(); } });
window.addEventListener('mouseup', () => isDrawing = false);
window.addEventListener('touchend', () => isDrawing = false);

function resetScratch() { initScratch(); }
initScratch();


/* =========================================
   LOGIC 2: SLOT MACHINE
   ========================================= */
const icons = ["‚öΩ", "üß§", "üü•", "üèÜ", "üëü"]; // Striker, Keeper, Card, Cup, Mid
const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
const slotBtn = document.getElementById('slotBtn');
const slotResult = document.getElementById('slotResult');
const iconHeight = 100;
const numIcons = icons.length;

// Initialize Reels
reels.forEach(reel => {
    let html = "";
    // Duplicate list 4 times to create a long strip for spinning illusion
    for(let k=0; k<4; k++) {
        icons.forEach(icon => html += `<div class="reel-icon">${icon}</div>`);
    }
    reel.innerHTML = html;
});

function spinSlots() {
    slotBtn.disabled = true;
    slotResult.innerText = "SPINNING...";
    slotResult.style.color = "#888";

    // Results
    const results = [
        Math.floor(Math.random() * numIcons),
        Math.floor(Math.random() * numIcons),
        Math.floor(Math.random() * numIcons)
    ];

    // Spin each reel
    reels.forEach((reel, i) => {
        const targetIndex = results[i];
        // Calculate position: (Full rotations) + (Target Index)
        // We add extra rotations for delay (Reel 1 stops first, then 2, then 3)
        const extraSpins = 2 + i; 
        const totalIcons = (icons.length * extraSpins) + targetIndex;
        const finalY = totalIcons * iconHeight;

        // Reset position to 0 instantly before spinning
        reel.style.transition = 'none';
        reel.style.top = '0px';
        
        // Force reflow
        void reel.offsetWidth;

        // Animate
        const duration = 1 + (i * 0.5); // 1s, 1.5s, 2s
        reel.style.transition = `top ${duration}s cubic-bezier(0.5, 0, 0.2, 1)`; // Ease-out effect
        reel.style.top = `-${finalY}px`;
    });

    // Check Win after longest spin (2s)
    setTimeout(() => {
        slotBtn.disabled = false;
        checkWin(results);
    }, 2100);
}

function checkWin(results) {
    const r1 = icons[results[0]];
    const r2 = icons[results[1]];
    const r3 = icons[results[2]];

    if(r1 === r2 && r2 === r3) {
        slotResult.innerHTML = "JACKPOT! 3X MULTIPLIER!";
        slotResult.style.color = "var(--neon-yellow)";
        slotResult.style.textShadow = "0 0 10px var(--neon-yellow)";
    } else if(r1 === r2 || r2 === r3 || r1 === r3) {
        slotResult.innerHTML = "PAIR MATCH! +10 PTS";
        slotResult.style.color = "var(--neon-cyan)";
        slotResult.style.textShadow = "none";
    } else {
        slotResult.innerHTML = "NO MATCH.";
        slotResult.style.color = "var(--neon-pink)";
        slotResult.style.textShadow = "none";
    }
}
</script>
</body>
</html>
