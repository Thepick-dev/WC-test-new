<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Predict â€” Retro Football</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0A0A1A;
  --yellow:#FFD60A;
  --cyan:#00FFFF;
  --nav-text:var(--yellow);
  --nav-active-bg:var(--yellow);
  --nav-active-text:#0A0A1A;
  --font: 'Press Start 2P', monospace;
  --pink:#FF2FC7;
  --pink-neon: #FF3CAC;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--yellow);font-family:var(--font);}
header.site-header{position:sticky;top:0;z-index:50;padding-top: 12px;}
nav.main-nav{display:flex;width:100%;justify-content:space-between;background:#0A0A1A;border-bottom:4px solid rgba(0,255,255,0.12)}
.nav-link{flex:1;text-align:center;padding:14px 0;text-decoration:none;color:var(--nav-text);border-right:1px solid rgba(0,255,255,0.06);transition:all .2s;font-size:11px;}
.nav-link:last-child{border-right:none;}
.nav-link:hover{color:var(--cyan);text-shadow:0 0 8px var(--cyan);}
.nav-link.active{background:var(--nav-active-bg);color:var(--nav-active-text);outline:3px solid var(--cyan);}
.banner{width:100%;height:160px;background-image:url('assets/predict.jpg');background-size:cover;background-position:center;margin-top:0;box-shadow:0 6px 18px rgba(0,255,255,0.1);}

/* main */
main{max-width:1100px;margin:18px auto;padding:18px;text-align:center;}
.form-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,255,255,0.01));
  border:6px solid rgba(0,255,255,0.06);
  padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(0,255,255,0.06);
}

/* inputs */
.row{display:flex;gap:12px;justify-content:center;margin-bottom:14px;flex-wrap:wrap;}
.input{
  display:flex;flex-direction:column;align-items:flex-start;
  font-size:9px;color:var(--yellow);width:240px;
}
.input label{font-size:10px;margin-bottom:8px;}
.input input{
  width:100%;padding:10px;border-radius:6px;border:4px solid rgba(0,255,255,0.06);
  background:transparent;color:var(--yellow);font-family:var(--font);font-size:11px;outline:none;
  box-shadow:inset 0 6px 18px rgba(0,0,0,0.5);
}
.input input::placeholder{color:rgba(255,214,10,0.35);font-family:var(--font);font-size:8px}

/* instruction text */
.instruction{font-size:10px;margin:8px 0 12px;color:var(--cyan);text-shadow:0 0 8px rgba(0,255,255,0.06);}

/* clear button */
.controls{display:flex;justify-content:center;gap:12px;margin-bottom:12px;}
.button-clear{padding:10px 14px;border-radius:8px;background:transparent;border:4px solid rgba(255,214,10,0.18);font-family:var(--font);cursor:pointer;color:var(--yellow);font-size:10px;}

/* groups grid - 2 rows of 6 groups */
.groups-grid{
  display:grid;
  grid-template-columns:repeat(6, 1fr);
  gap:12px;margin-top:12px;
}
.group{
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
  border:4px solid rgba(0,255,255,0.04);padding:8px;border-radius:10px;
  min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
}
.group h4{font-size:10px;margin-bottom:8px;color:var(--yellow);text-transform:uppercase;}
.team-list{display:flex;flex-direction:column;gap:8px;width:100%;}
.team-btn{
  font-family:var(--font);font-size:10px;padding:8px;border-radius:6px;border:3px solid rgba(0,255,255,0.04);
  background:transparent;color:var(--yellow);cursor:pointer;text-align:center;outline:none;
  transition:all .12s;box-shadow:0 6px 0 rgba(0,0,0,0.45);
}
.team-btn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,255,255,0.04);color:var(--cyan)}
.team-btn.selected-2{background:var(--yellow);color:#0A0A1A;box-shadow:0 10px 30px rgba(255,214,10,0.12);border-color:rgba(255,214,10,0.7);}
.team-btn.selected-3{background:linear-gradient(90deg,var(--pink-neon),var(--pink));color:#0A0A1A;box-shadow:0 8px 40px rgba(255,50,150,0.18);border-color:rgba(255,50,150,0.6);}

/* top text */
.top-instruction{font-size:10px;margin-bottom:6px;color:var(--yellow);}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:9999;}
.modal{background:#071; /* placeholder - we'll restyle below */ padding:20px;border-radius:12px;border:6px solid rgba(0,255,255,0.06);width:320px;max-width:90%;}
.modal .title{font-size:12px;color:var(--yellow);margin-bottom:12px;text-align:center;}
.modal .actions{display:flex;gap:12px;justify-content:center;margin-top:12px;}
.modal .btn{padding:10px 14px;border-radius:8px;border:6px solid transparent;background:var(--yellow);cursor:pointer;font-family:var(--font);}

/* small screens */
@media(max-width:1100px){
  .groups-grid{grid-template-columns:repeat(4, 1fr);}
}
@media(max-width:820px){
  .groups-grid{grid-template-columns:repeat(2, 1fr);}
  .input{width:100%}
  .row{flex-direction:column;align-items:center}
}
</style>
</head>
<body>
<header class="site-header">
  <nav class="main-nav" aria-label="Main navigation">
    <a class="nav-link" href="index.html">HOME</a>
    <a class="nav-link active" href="predict.html">PREDICT</a>
    <a class="nav-link" href="standings.html">STANDINGS</a>
    <a class="nav-link" href="rules.html">RULES</a>
  </nav>
  <div class="banner" role="img" aria-label="Predict banner"></div>
</header>

<main>
  <div class="form-card" id="predictCard">
    <div class="top-instruction" id="topInstruction">Pick the team you think will finish second in each group</div>

    <div class="row" aria-hidden="false">
      <div class="input">
        <label for="nameInput">NAME</label>
        <input id="nameInput" type="text" placeholder="YOUR NAME">
      </div>
      <div class="input">
        <label for="emailInput">EMAIL</label>
        <input id="emailInput" type="email" placeholder="EMAIL@EXAMPLE.COM">
      </div>
      <div class="input">
        <label for="pinInput">4 DIGIT PIN</label>
        <input id="pinInput" type="text" maxlength="4" inputmode="numeric" pattern="\d{4}" placeholder="1234">
      </div>
      <div class="input">
        <label for="goalsInput">HOW MANY GOALS WILL BE SCORED IN THE GROUP STAGE?</label>
        <input id="goalsInput" type="number" min="0" placeholder="TOTAL GOALS">
      </div>
    </div>

    <div class="instruction" id="secondaryInstruction">Pick the team you think will finish second in each group</div>

    <div class="controls">
      <button id="clearBtn" class="button-clear" title="Clear selections">CLEAR</button>
    </div>

    <!-- groups grid: 12 groups in 2 rows of 6 -->
    <div class="groups-grid" id="groupsGrid" role="list" aria-label="Groups">
      <!-- Groups populated by JS -->
    </div>
  </div>
</main>

<footer>
  <a href="privacy.html">Privacy Policy</a>
</footer>

<audio id="bgAudio" src="assets/ko.mp3" preload="auto" playsinline autoplay loop></audio>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document" style="background:linear-gradient(180deg, rgba(0,0,0,0.85), rgba(8,12,22,0.95));">
    <div class="title" id="modalTitle">SUBMIT?</div>
    <div style="font-size:10px;color:var(--cyan);text-align:center;">Are you sure you want to submit your picks?</div>
    <div class="actions">
      <button id="modalYes" class="btn">YES</button>
      <button id="modalNo" class="btn" style="background:transparent;border:6px solid rgba(255,214,10,0.18);">NO</button>
    </div>
  </div>
</div>

<script>
/* audio attempt */
const audio=document.getElementById('bgAudio');
function tryPlay(){audio.play().catch(()=>{});}
window.addEventListener('load',tryPlay);
document.addEventListener('visibilitychange',()=>{if(!document.hidden){tryPlay();}});

/* Groups data - from your randomized groups (12 groups of 4) */
const GROUPS = [
  ["Norway","Ecuador","Germany","Uefa Play-off B"],    // Group 1
  ["Ghana","Saudi Arabia","South Korea","Croatia"],     // Group 2
  ["Uefa Play-off C","Curacao","Canada","Belgium"],     // Group 3
  ["Paraguay","England","Qatar","Austria"],             // Group 4
  ["South Africa","Haiti","Morocco","Switzerland"],     // Group 5
  ["United States","Uefa Play-off D","Japan","Fifa Play-off 2"], // Group 6
  ["Egypt","Argentina","Uefa Play-off A","Jordan"],     // Group 7
  ["Netherlands","Uzbekistan","Portugal","Panama"],     // Group 8
  ["Spain","Mexico","Tunisia","France"],                // Group 9
  ["Ivory Coast","New Zealand","Scotland","Cape Verde"],// Group 10
  ["Brazil","Senegal","Australia","Iran"],              // Group 11
  ["Algeria","Colombia","Fifa Play-off 1","Uruguay"]    // Group 12
];

/* State */
const state = {
  stage: 1, // 1 = pick second for each group; 2 = pick eight 3rd place teams
  secondPicks: Array(GROUPS.length).fill(null), // store index (0..3) of chosen team for 2nd in each group
  thirdPicks: Array(GROUPS.length).fill(false), // boolean - whether a team in that group chosen as 3rd
  thirdPickDetails: Array(GROUPS.length).fill(null), // store index chosen for 3rd per group (or null)
  thirdCount: 0
};

/* DOM */
const groupsGrid = document.getElementById('groupsGrid');
const topInstruction = document.getElementById('topInstruction');
const secondaryInstruction = document.getElementById('secondaryInstruction');
const clearBtn = document.getElementById('clearBtn');
const modalBackdrop = document.getElementById('modalBackdrop');
const modalYes = document.getElementById('modalYes');
const modalNo = document.getElementById('modalNo');

function createGroupElement(groupIndex, teams){
  const g = document.createElement('div');
  g.className = 'group';
  g.setAttribute('data-group', groupIndex);
  g.setAttribute('role','listitem');

  const title = document.createElement('h4');
  title.textContent = 'GROUP ' + (groupIndex + 1);
  g.appendChild(title);

  const teamList = document.createElement('div');
  teamList.className = 'team-list';

  teams.forEach((team, i) => {
    const btn = document.createElement('button');
    btn.className = 'team-btn';
    btn.type = 'button';
    btn.textContent = team;
    btn.setAttribute('data-team-index', i);
    btn.setAttribute('data-group-index', groupIndex);
    btn.setAttribute('aria-pressed','false');
    btn.addEventListener('click', onTeamClick);
    teamList.appendChild(btn);
  });

  g.appendChild(teamList);
  return g;
}

/* render groups */
function renderGroups(){
  groupsGrid.innerHTML = '';
  GROUPS.forEach((teams, idx) => {
    groupsGrid.appendChild(createGroupElement(idx, teams));
  });
}
renderGroups();

/* Helpers */
function updateTopText(){
  if(state.stage === 1){
    topInstruction.textContent = 'Pick the team you think will finish second in each group';
    secondaryInstruction.textContent = 'Pick the team you think will finish second in each group';
  } else {
    topInstruction.textContent = 'Pick eight teams you think will qualify in 3rd place';
    secondaryInstruction.textContent = 'Now, pick eight teams who will finish third (no more than one per group).';
  }
}

function getTeamButton(groupIndex, teamIndex){
  return document.querySelector('.team-btn[data-group-index="'+groupIndex+'"][data-team-index="'+teamIndex+'"]');
}

/* Click logic */
function onTeamClick(e){
  const btn = e.currentTarget;
  const g = Number(btn.getAttribute('data-group-index'));
  const t = Number(btn.getAttribute('data-team-index'));

  if(state.stage === 1){
    // Selecting second-place in group g -> set secondPicks[g] to t
    const previous = state.secondPicks[g];
    if(previous === t){
      // deselect
      state.secondPicks[g] = null;
      btn.classList.remove('selected-2');
      btn.setAttribute('aria-pressed','false');
    } else {
      // unselect previous button in this group
      if(previous !== null){
        const prevBtn = getTeamButton(g, previous);
        if(prevBtn) { prevBtn.classList.remove('selected-2'); prevBtn.setAttribute('aria-pressed','false'); }
      }
      // set this as second
      state.secondPicks[g] = t;
      btn.classList.add('selected-2');
      btn.setAttribute('aria-pressed','true');
    }
    // After each change, check if all 12 are selected -> advance stage
    const allSelected = state.secondPicks.every(x => x !== null);
    if(allSelected){
      state.stage = 2;
      updateTopText();
      // visual cue: let user know they can pick 3rd teams now
    }
    // If user is in stage2 and deselects (shouldn't happen here because stage===1)
  } else {
    // stage 2 logic (pick up to 8 teams, no more than one per group)
    const groupHasSecond = state.secondPicks[g] !== null;

    // If the clicked team is the currently selected second in this group and user clicks it during stage2:
    // allow toggling third selection too (user may pick same team as third if desired) - requirement says
    // "if they pick on a team in a group where they have already selected a second placed team ... will light up pink"
    const isAlreadyThirdHere = state.thirdPickDetails[g] === t;
    if(isAlreadyThirdHere){
      // deselect third
      state.thirdPickDetails[g] = null;
      state.thirdPicks[g] = false;
      state.thirdCount = Math.max(0, state.thirdCount - 1);
      btn.classList.remove('selected-3');
      btn.setAttribute('aria-pressed','false');
      checkForSubmit();
      return;
    }

    // If this group already has a third chosen and it's different team, toggle off the previous third
    if(state.thirdPickDetails[g] !== null){
      const prevThirdIndex = state.thirdPickDetails[g];
      const prevBtn = getTeamButton(g, prevThirdIndex);
      if(prevBtn) { prevBtn.classList.remove('selected-3'); prevBtn.setAttribute('aria-pressed','false'); }
      state.thirdPicks[g] = false;
      state.thirdPickDetails[g] = null;
      // reduce count
      state.thirdCount = Math.max(0, state.thirdCount - 1);
      // Now continue to potentially set this team as third below
    }

    // If already have 8 third picks, prevent adding more
    if(state.thirdCount >= 8)
