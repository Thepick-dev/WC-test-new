<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Predict â€” Retro Football</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{--bg:#0A0A1A;--yellow:#FFD60A;--cyan:#00FFFF;--nav-text:var(--yellow);--nav-active-bg:var(--yellow);--nav-active-text:#0A0A1A;font-family:'Press Start 2P',monospace;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--yellow);font-family:'Press Start 2P',monospace;}
header.site-header{position:sticky;top:0;z-index:50;padding-top:12px;}
nav.main-nav{display:flex;width:100%;justify-content:space-between;background:#0A0A1A;border-bottom:4px solid rgba(0,255,255,0.12)}
.nav-link{flex:1;text-align:center;padding:14px 0;text-decoration:none;color:var(--nav-text);border-right:1px solid rgba(0,255,255,0.06);font-size:11px;}
.nav-link:last-child{border-right:none;}
.nav-link:hover{color:var(--cyan);text-shadow:0 0 8px var(--cyan);}
.nav-link.active{background:var(--nav-active-bg);color:var(--nav-active-text);outline:3px solid var(--cyan);}
.banner{width:100%;height:160px;background-image:url('assets/predict.jpg');background-size:cover;background-position:center;margin-top:0;box-shadow:0 6px 18px rgba(0,255,255,0.1);}
main{max-width:960px;margin:24px auto;padding:12px;text-align:center;}
.pred-btn{display:inline-block;padding:16px 24px;border-radius:6px;background:var(--yellow);color:#0A0A1A;border:6px solid transparent;font-size:11px;cursor:pointer;margin:6px;}
.form-card{background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));border:6px solid rgba(0,255,255,0.06);padding:14px;border-radius:10px;margin-top:16px;}
.row{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:12px;}
.input{width:240px;display:flex;flex-direction:column;align-items:flex-start;font-size:9px;color:var(--yellow);}
.input label{font-size:10px;margin-bottom:6px;}
.input input{width:100%;padding:10px;border-radius:6px;border:4px solid rgba(0,255,255,0.06);background:transparent;color:var(--yellow);font-family:'Press Start 2P',monospace;font-size:11px;outline:none;}
.input input::placeholder{color:rgba(255,214,10,0.35);font-family:'Press Start 2P',monospace;font-size:9px}
.instruction{font-size:10px;margin:8px 0;color:var(--cyan);}
.controls{display:flex;justify-content:center;margin-bottom:12px;gap:12px;}
.button-clear{padding:10px 12px;border-radius:8px;background:transparent;border:4px solid rgba(255,214,10,0.18);cursor:pointer;color:var(--yellow);font-size:10px;}
.submit-btn{padding:10px 14px;border-radius:8px;background:transparent;border:6px solid rgba(255,214,10,0.12);cursor:not-allowed;color:rgba(255,214,10,0.35);font-size:10px;transition:all .15s;box-shadow:none;}
.submit-btn.lit{cursor:pointer;color:#0A0A1A;background:var(--yellow);box-shadow:0 10px 30px rgba(255,214,10,0.12),0 0 30px rgba(255,214,10,0.25),0 0 80px rgba(255,214,10,0.08) inset;border-color:rgba(255,214,10,0.9);}
.groups-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;}
.group{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));border:4px solid rgba(0,255,255,0.04);padding:10px;border-radius:8px;min-height:120px;display:flex;flex-direction:column;align-items:center;}
.group h4{font-size:10px;margin-bottom:8px;color:var(--yellow);}
.team-list{display:flex;flex-direction:column;gap:8px;width:100%;}
.team-btn{font-family:'Press Start 2P',monospace;font-size:10px;padding:8px;border-radius:6px;border:3px solid rgba(0,255,255,0.04);background:transparent;color:var(--yellow);cursor:pointer;text-align:center;}
.team-btn:hover{transform:translateY(-2px);color:var(--cyan);}
.team-btn.selected-2{background:var(--yellow);color:#0A0A1A;border-color:rgba(255,214,10,0.7);}
.team-btn.selected-3{background:linear-gradient(90deg,#FF3CAC,#FF2FC7);color:#0A0A1A;border-color:rgba(255,50,150,0.6);}
.top-instruction{font-size:10px;margin-bottom:6px;color:var(--yellow);}
@media(max-width:1100px){.groups-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.groups-grid{grid-template-columns:repeat(2,1fr)}.input{width:100%}.row{flex-direction:column;align-items:center}}
</style>
</head>
<body>
<header class="site-header">
  <nav class="main-nav">
    <a class="nav-link" href="index.html">HOME</a>
    <a class="nav-link active" href="predict.html">PREDICT</a>
    <a class="nav-link" href="standings.html">STANDINGS</a>
    <a class="nav-link" href="rules.html">RULES</a>
  </nav>
  <div class="banner"></div>
</header>

<main>
<div class="form-card" id="predictCard">
  <div class="top-instruction" id="instruction">Pick the team you think will finish second in each group</div>
  <div class="row" id="inputsRow">
    <div class="input"><label for="nameInput">USERNAME</label><input id="nameInput" type="text" placeholder="YOUR USERNAME"></div>
    <div class="input"><label for="emailInput">EMAIL</label><input id="emailInput" type="email" placeholder="EMAIL@EXAMPLE.COM"></div>
    <div class="input"><label for="pinInput">4 DIGIT PIN</label><input id="pinInput" type="text" maxlength="4" pattern="\d{4}" placeholder="1234"></div>
    <div class="input"><label for="goalsInput">Total goals in group stage</label><input id="goalsInput" type="number" min="0" placeholder="TOTAL GOALS"></div>
  </div>

  <div class="instruction" id="secondaryInstruction">Pick the team you think will finish second in each group</div>
  <div class="controls">
    <button id="clearBtn" class="button-clear">CLEAR</button>
    <button id="submitBtn" class="submit-btn">SUBMIT</button>
  </div>

  <div class="groups-grid" id="groupsGrid"></div>
</div>
</main>

<footer>
  <a href="privacy.html">Privacy Policy</a>
</footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyMXhiZPghhHmhMms3pqFPZVvf6d7BU1vdl0enXRjCwzntSdQb0q7n-aPEAyIFWVlK6wA/exec";
const SECRET = "G7tR4kM9pS1vQ2zL";

// Group data
const GROUPS = [
  ["Norway","Ecuador","Germany","Uefa Play-off B"],
  ["Ghana","Saudi Arabia","South Korea","Croatia"],
  ["Uefa Play-off C","Curacao","Canada","Belgium"],
  ["Paraguay","England","Qatar","Austria"],
  ["South Africa","Haiti","Morocco","Switzerland"],
  ["United States","Uefa Play-off D","Japan","Fifa Play-off 2"],
  ["Egypt","Argentina","Uefa Play-off A","Jordan"],
  ["Netherlands","Uzbekistan","Portugal","Panama"],
  ["Spain","Mexico","Tunisia","France"],
  ["Ivory Coast","New Zealand","Scotland","Cape Verde"],
  ["Brazil","Senegal","Australia","Iran"],
  ["Algeria","Colombia","Fifa Play-off 1","Uruguay"]
];

let state = {
  stage:1,
  secondPicks: Array(GROUPS.length).fill(null),
  thirdPicksIndex: Array(GROUPS.length).fill(null),
  thirdCount:0
};

const groupsGrid = document.getElementById('groupsGrid');
const instructionEl = document.getElementById('instruction');
const secondaryInstruction = document.getElementById('secondaryInstruction');
const clearBtn = document.getElementById('clearBtn');
const submitBtn = document.getElementById('submitBtn');

function createGroupEl(i, teams){
  const g = document.createElement('div'); g.className='group'; g.setAttribute('data-group',i);
  g.innerHTML=`<h4>GROUP ${i+1}</h4><div class="team-list"></div>`;
  const list = g.querySelector('.team-list');
  teams.forEach((team,idx)=>{
    const btn=document.createElement('button');
    btn.className='team-btn';
    btn.type='button';
    btn.textContent=team;
    btn.setAttribute('data-group',i);
    btn.setAttribute('data-index',idx);
    btn.setAttribute('aria-pressed','false');
    btn.addEventListener('click',onTeamClick);
    list.appendChild(btn);
  });
  return g;
}

function renderGroups(){groupsGrid.innerHTML='';GROUPS.forEach((g,i)=>groupsGrid.appendChild(createGroupEl(i,g)));}
renderGroups();

function btnFor(groupIndex, teamIndex){return document.querySelector(`.team-btn[data-group="${groupIndex}"][data-index="${teamIndex}"]`);}

function updateInstructions(){
  if(state.stage===1){
    instructionEl.textContent='Pick the team you think will finish second in each group';
    secondaryInstruction.textContent='Pick the team you think will finish second in each group';
  }else{
    instructionEl.textContent='Pick eight teams you think will qualify in 3rd place';
    secondaryInstruction.textContent='Now pick 8 teams for 3rd place (no more than one per group).';
  }
}

function onTeamClick(e){
  const btn=e.currentTarget; const g=Number(btn.getAttribute('data-group')); const t=Number(btn.getAttribute('data-index'));
  if(state.stage===1){
    const prev=state.secondPicks[g];
    if(prev===t){state.secondPicks[g]=null;btn.classList.remove('selected-2');btn.setAttribute('aria-pressed','false');}
    else{
      if(prev!==null){const prevBtn=btnFor(g,prev);if(prevBtn){prevBtn.classList.remove('selected-2');prevBtn.setAttribute('aria-pressed','false');}}
      if(state.thirdPicksIndex[g]===t){state.thirdPicksIndex[g]=null;state.thirdCount=Math.max(0,state.thirdCount-1);const wasThirdBtn=btnFor(g,t);if(wasThirdBtn)wasThirdBtn.classList.remove('selected-3');}
      state.secondPicks[g]=t;btn.classList.add('selected-2');btn.setAttribute('aria-pressed','true');
    }
    if(state.secondPicks.every(x=>x!==null)){state.stage=2;updateInstructions();}
    checkForSubmit();return;
  }
  const currentThird=state.thirdPicksIndex[g];
  if(currentThird===t){state.thirdPicksIndex[g]=null;state.thirdCount=Math.max(0,state.thirdCount-1);const btnCur=btnFor(g,t);if(btnCur)btnCur.classList.remove('selected-3');checkForSubmit();return;}
  if(state.thirdCount>=8){alert('You already selected 8 third-place teams');return;}
  state.thirdPicksIndex[g]=t;state.thirdCount++;const clickedBtn=btnFor(g,t);if(clickedBtn){clickedBtn.classList.add('selected-3');clickedBtn.setAttribute('aria-pressed','true');}
  checkForSubmit();
}

function resetAll(){
  state.stage=1;
  state.secondPicks=Array(GROUPS.length).fill(null);
  state.thirdPicksIndex=Array(GROUPS.length).fill(null);
  state.thirdCount=0;
  document.querySelectorAll('.team-btn').forEach(b=>{b.classList.remove('selected-2','selected-3');b.setAttribute('aria-pressed','false');});
  document.getElementById('nameInput').value='';
  document.getElementById('emailInput').value='';
  document.getElementById('pinInput').value='';
  document.getElementById('goalsInput').value='';
  updateInstructions();
  setSubmitState(false);
}

function inputsFilled(){
  const name=document.getElementById('nameInput').value.trim();
  const email=document.getElementById('emailInput').value.trim();
  const pin=document.getElementById('pinInput').value.trim();
  const goals=document.getElementById('goalsInput').value.trim();
  const pinOk=/^\d{4}$/.test(pin);
  return name&&email&&pinOk&&goals!=='';
}

function allSecondsSet(){return state.secondPicks.every(x=>x!==null);}
function allThirdsSelected(){return state.thirdCount===8;}

function setSubmitState(lit){
  if(lit){submitBtn.classList.add('lit');submitBtn.disabled=false;submitBtn.style.cursor='pointer';}
  else{submitBtn.classList.remove('lit');submitBtn.disabled=true;submitBtn.style.cursor='not-allowed';}
}

function checkForSubmit(){
  const ready=allSecondsSet()&&allThirdsSelected()&&inputsFilled();
  setSubmitState(ready);
}

clearBtn.addEventListener('click',resetAll);

submitBtn.addEventListener('click', async ()=>{
  if(!submitBtn.classList.contains('lit'))return;
  const payload={
    secret:SECRET,
    username:document.getElementById('nameInput').value.trim(),
    email:document.getElementById('emailInput').value.trim(),
    pin:document.getElementById('pinInput').value.trim(),
    goals:document.getElementById('goalsInput').value.trim(),
    seconds: state.secondPicks.map((idx,g)=>({group:g+1,team:idx===null?null:GROUPS[g][idx]})),
    thirds: state.thirdPicksIndex.map((idx,g)=>({group:g+1,team:idx===null?null:GROUPS[g][idx]})).filter(x=>x.team!==null)
  };

  try{
    const res=await fetch(SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const data=await res.json();
    if(data.success){alert('Submission recorded!');resetAll();}
    else{alert('Submission failed: '+data.error);}
  }catch(err){alert('Submission failed: '+err);}
});

['nameInput','emailInput','pinInput','goalsInput'].forEach(id=>document.getElementById(id).addEventListener('input',checkForSubmit));

updateInstructions();
resetAll();
</script>
</body>
</html>
