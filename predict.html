<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Predict â€” Retro Football</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{--bg:#0A0A1A;--yellow:#FFD60A;--cyan:#00FFFF;--nav-text:var(--yellow);--nav-active-bg:var(--yellow);--nav-active-text:#0A0A1A;font-family:'Press Start 2P',monospace;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--yellow);font-family:'Press Start 2P',monospace;}

/* header/banner EXACT as Version 1 */
header.site-header{position:sticky;top:0;z-index:50;padding-top: 12px;}
nav.main-nav{display:flex;width:100%;justify-content:space-between;background:#0A0A1A;border-bottom:4px solid rgba(0,255,255,0.12)}
.nav-link{flex:1;text-align:center;padding:14px 0;text-decoration:none;color:var(--nav-text);border-right:1px solid rgba(0,255,255,0.06);transition:all .2s;font-size:11px;}
.nav-link:last-child{border-right:none;}
.nav-link:hover{color:var(--cyan);text-shadow:0 0 8px var(--cyan);}
.nav-link.active{background:var(--nav-active-bg);color:var(--nav-active-text);outline:3px solid var(--cyan);}
.banner{width:100%;height:160px;background-image:url('assets/predict.jpg');background-size:cover;background-position:center;margin-top:0;box-shadow:0 6px 18px rgba(0,255,255,0.1);}

/* global layout */
main{max-width:1100px;margin:18px auto;padding:18px;text-align:center;}

/* Title */
.title-wrap{display:flex;align-items:center;justify-content:center;margin:6px 0 12px;}
.title{
  font-family:'Press Start 2P',monospace;
  font-size:28px;
  letter-spacing:2px;
  color:var(--yellow);
  padding:8px 12px;
  text-shadow:0 0 12px rgba(255,214,10,0.25),0 0 24px rgba(0,255,255,0.06);
}

/* form card area with sliding panels */
.form-shell{position:relative;overflow:hidden;border-radius:12px;}
.form-inner{display:flex;transition:transform .45s cubic-bezier(.2,.9,.2,1);width:200%;} /* two panels side by side */
.panel{width:50%;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));border:6px solid rgba(0,255,255,0.06);min-height:420px;box-sizing:border-box;}
.main-panel{ /* left panel */ }
.side-panel{ /* right panel for account */ }

/* small UI bits */
.form-card{background:transparent;padding:0;border:none;}
.row{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:12px;}
.input{width:240px;display:flex;flex-direction:column;align-items:flex-start;font-size:9px;color:var(--yellow);}
.input label{font-size:10px;margin-bottom:6px;}
.input input, .input select{
  width:100%;padding:10px;border-radius:6px;border:4px solid rgba(0,255,255,0.06);background:transparent;color:var(--yellow);font-family:'Press Start 2P',monospace;font-size:11px;outline:none;
}
.input select option{background:#07101a;color:var(--yellow);}

/* instruction visible above groups */
.instruction{font-size:10px;margin:8px 0;color:var(--cyan);text-shadow:0 0 8px rgba(0,255,255,0.06);}

/* controls */
.controls{display:flex;justify-content:center;margin-bottom:12px;gap:12px;}
.button-clear{padding:10px 12px;border-radius:8px;background:transparent;border:4px solid rgba(255,214,10,0.18);font-family:'Press Start 2P',monospace;cursor:pointer;color:var(--yellow);font-size:10px;}
.continue-btn{padding:10px 12px;border-radius:8px;background:transparent;border:6px solid rgba(0,255,255,0.06);font-family:'Press Start 2P',monospace;cursor:not-allowed;color:rgba(255,214,10,0.35);font-size:10px;}
.continue-btn.enabled{cursor:pointer;color:#0A0A1A;background:var(--yellow);border-color:rgba(255,214,10,0.9);box-shadow:0 12px 40px rgba(255,214,10,0.08);}

/* Submit button (in side panel) */
.submit-btn{padding:10px 14px;border-radius:8px;background:transparent;border:6px solid rgba(255,214,10,0.12);font-family:'Press Start 2P',monospace;cursor:not-allowed;color:rgba(255,214,10,0.35);font-size:10px;transition:all .15s;box-shadow: none;}
.submit-btn.lit{cursor:pointer;color:#0A0A1A;background:var(--yellow);box-shadow:0 10px 30px rgba(255,214,10,0.12),0 0 30px rgba(255,214,10,0.25),0 0 80px rgba(255,214,10,0.08) inset;border-color:rgba(255,214,10,0.9);}

/* groups */
.groups-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-top:12px}
.group{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));border:4px solid rgba(0,255,255,0.04);padding:10px;border-radius:8px;min-height:120px;display:flex;flex-direction:column;align-items:center;}
.group h4{font-size:10px;margin-bottom:8px;color:var(--yellow);text-transform:uppercase;}
.team-list{display:flex;flex-direction:column;gap:8px;width:100%;}
.team-btn{font-family:'Press Start 2P',monospace;font-size:10px;padding:8px;border-radius:6px;border:3px solid rgba(0,255,255,0.04);background:transparent;color:var(--yellow);cursor:pointer;text-align:center;outline:none;transition:all .12s;box-shadow:0 6px 0 rgba(0,0,0,0.45);}
.team-btn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,255,255,0.04);color:var(--cyan)}
.team-btn.selected-2{background:var(--yellow);color:#0A0A1A;box-shadow:0 10px 30px rgba(255,214,10,0.12);border-color:rgba(255,214,10,0.7);}
.team-btn.selected-3{background:linear-gradient(90deg,#FF3CAC,#FF2FC7);color:#0A0A1A;box-shadow:0 8px 40px rgba(255,50,150,0.18);border-color:rgba(255,50,150,0.6);}

/* slide helpers */
.form-shell{max-width:1100px;margin:0 auto;}
.form-inner[data-pos="0"]{transform:translateX(0%);}
.form-inner[data-pos="1"]{transform:translateX(-50%);} /* slide left to show right panel */

/* side panel layout */
.side-panel .row{margin-top:6px;}
.side-panel .nav-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.back-btn{padding:8px 10px;border-radius:8px;background:transparent;border:4px solid rgba(0,255,255,0.06);color:var(--yellow);cursor:pointer;font-family:'Press Start 2P',monospace;}

/* small screens */
@media(max-width:1100px){.groups-grid{grid-template-columns:repeat(4, 1fr)}.panel{padding:12px}}
@media(max-width:820px){
  .groups-grid{grid-template-columns:repeat(2, 1fr)}
  .input{width:100%}
  .row{flex-direction:column;align-items:center}
  .form-inner{width:200%}
  .panel{width:50%}
  .title{font-size:20px}
}
</style>
</head>
<body>
<header class="site-header">
  <nav class="main-nav" aria-label="Main navigation">
    <a class="nav-link" href="index.html">HOME</a>
    <a class="nav-link active" href="predict.html">PREDICT</a>
    <a class="nav-link" href="standings.html">STANDINGS</a>
    <a class="nav-link" href="rules.html">RULES</a>
  </nav>

  <!-- Title (Goalstorm) above banner -->
  <div class="title-wrap">
    <div class="title">GOALSTORM</div>
  </div>

  <div class="banner" role="img" aria-label="Predict banner"></div>
</header>

<main>
  <div class="form-shell">
    <div class="form-inner" id="formInner" data-pos="0">
      <!-- LEFT: main picks panel -->
      <div class="panel main-panel">
        <div class="form-card">
          <!-- First question: dropdown of combos -->
          <div class="row" style="justify-content:center;margin-bottom:6px;">
            <div class="input" style="width:640px;max-width:100%;">
              <label for="comboSelect">Pick the combination of players you think will score the most goals in the idea tournament</label>
              <select id="comboSelect" aria-label="Combo selection">
                <option value="">-- pick a combo (placeholder) --</option>
                <!-- 30 placeholder options -->
                <option>Combo 1 - Player A + Player B</option>
                <option>Combo 2 - Player C + Player D</option>
                <option>Combo 3 - Player E + Player F</option>
                <option>Combo 4 - Player G + Player H</option>
                <option>Combo 5 - Player I + Player J</option>
                <option>Combo 6 - Player K + Player L</option>
                <option>Combo 7 - Player M + Player N</option>
                <option>Combo 8 - Player O + Player P</option>
                <option>Combo 9 - Player Q + Player R</option>
                <option>Combo 10 - Player S + Player T</option>
                <option>Combo 11 - Player U + Player V</option>
                <option>Combo 12 - Player W + Player X</option>
                <option>Combo 13 - Player Y + Player Z</option>
                <option>Combo 14 - Player AA + Player BB</option>
                <option>Combo 15 - Player CC + Player DD</option>
                <option>Combo 16 - Player EE + Player FF</option>
                <option>Combo 17 - Player GG + Player HH</option>
                <option>Combo 18 - Player II + Player JJ</option>
                <option>Combo 19 - Player KK + Player LL</option>
                <option>Combo 20 - Player MM + Player NN</option>
                <option>Combo 21 - Player OO + Player PP</option>
                <option>Combo 22 - Player QQ + Player RR</option>
                <option>Combo 23 - Player SS + Player TT</option>
                <option>Combo 24 - Player UU + Player VV</option>
                <option>Combo 25 - Player WW + Player XX</option>
                <option>Combo 26 - Player YY + Player ZZ</option>
                <option>Combo 27 - Player AAA + Player BBB</option>
                <option>Combo 28 - Player CCC + Player DDD</option>
                <option>Combo 29 - Player EEE + Player FFF</option>
                <option>Combo 30 - Player GGG + Player HHH</option>
              </select>
            </div>
          </div>

          <!-- Tiebreaker -->
          <div class="row" style="justify-content:center;">
            <div class="input">
              <label for="goalsInput">How many goals will be scored in the group stage? (Tiebreaker)</label>
              <input id="goalsInput" type="number" min="0" placeholder="TOTAL GOALS">
            </div>
          </div>

          <!-- instruction appears once above groups -->
          <div class="instruction" id="groupsInstruction">Pick the team you think will finish second in each group</div>

          <!-- controls: clear + continue (continue slides to account panel) -->
          <div class="controls">
            <button id="clearBtn" class="button-clear" title="Clear selections">CLEAR</button>
            <button id="continueBtn" class="continue-btn" title="Continue to account">CONTINUE TO ACCOUNT</button>
          </div>

          <!-- Groups grid -->
          <div class="groups-grid" id="groupsGrid" role="list" aria-label="Groups"></div>
        </div>
      </div>

      <!-- RIGHT: side panel for account input -->
      <div class="panel side-panel">
        <div class="side-card">
          <div class="nav-row">
            <div style="font-size:10px;color:var(--cyan)">Account</div>
            <button id="backBtn" class="back-btn" title="Back to picks">BACK</button>
          </div>

          <div class="row">
            <div class="input">
              <label for="nameInput">USERNAME</label>
              <input id="nameInput" type="text" placeholder="YOUR USERNAME">
            </div>
            <div class="input">
              <label for="emailInput">EMAIL</label>
              <input id="emailInput" type="email" placeholder="EMAIL@EXAMPLE.COM">
            </div>
            <div class="input">
              <label for="pinInput">4 DIGIT PIN</label>
              <input id="pinInput" type="text" maxlength="4" inputmode="numeric" pattern="\d{4}" placeholder="1234">
            </div>
          </div>

          <div class="controls" style="margin-top:18px;">
            <button id="submitBtn" class="submit-btn" title="Submit picks">SUBMIT</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer>
  <a href="privacy.html">Privacy Policy</a>
</footer>

<!-- keep audio EXACTLY as originally supplied and behaviour to attempt autoplay -->
<audio id="bgAudio" src="assets/ko.mp3" preload="auto" playsinline autoplay loop></audio>
<script>
const audio=document.getElementById('bgAudio');
function tryPlay(){audio.play().catch(()=>{});}
window.addEventListener('load',tryPlay);
document.addEventListener('visibilitychange',()=>{if(!document.hidden){tryPlay();}});
</script>

<script>
/* ------------------------------------------------
   Groups data (your randomized 12 groups)
   Logic maintained: pick 1 second per group (12) -> then pick 8 thirds -> total 20
   ------------------------------------------------ */
const GROUPS = [
  ["Norway","Ecuador","Germany","Uefa Play-off B"],    // 1
  ["Ghana","Saudi Arabia","South Korea","Croatia"],     // 2
  ["Uefa Play-off C","Curacao","Canada","Belgium"],     // 3
  ["Paraguay","England","Qatar","Austria"],             // 4
  ["South Africa","Haiti","Morocco","Switzerland"],     // 5
  ["United States","Uefa Play-off D","Japan","Fifa Play-off 2"], // 6
  ["Egypt","Argentina","Uefa Play-off A","Jordan"],     // 7
  ["Netherlands","Uzbekistan","Portugal","Panama"],     // 8
  ["Spain","Mexico","Tunisia","France"],                // 9
  ["Ivory Coast","New Zealand","Scotland","Cape Verde"],//10
  ["Brazil","Senegal","Australia","Iran"],              //11
  ["Algeria","Colombia","Fifa Play-off 1","Uruguay"]    //12
];

/* -------------------------
   State
   ------------------------- */
const state = {
  stage: 1, // used internally; continue button moves to stage 2 (account)
  secondPicks: Array(GROUPS.length).fill(null),
  thirdPicksIndex: Array(GROUPS.length).fill(null),
  thirdCount: 0
};

/* DOM refs */
const groupsGrid = document.getElementById('groupsGrid');
const clearBtn = document.getElementById('clearBtn');
const continueBtn = document.getElementById('continueBtn');
const formInner = document.getElementById('formInner');
const comboSelect = document.getElementById('comboSelect');
const goalsInput = document.getElementById('goalsInput');
const backBtn = document.getElementById('backBtn');
const submitBtn = document.getElementById('submitBtn');
const nameInput = document.getElementById('nameInput');
const emailInput = document.getElementById('emailInput');
const pinInput = document.getElementById('pinInput');

/* Render groups */
function createGroupEl(i, teams){
  const g = document.createElement('div');
  g.className = 'group';
  g.setAttribute('data-group', i);
  g.innerHTML = `<h4>GROUP ${i+1}</h4><div class="team-list"></div>`;
  const list = g.querySelector('.team-list');
  teams.forEach((team, idx) => {
    const btn = document.createElement('button');
    btn.className = 'team-btn';
    btn.type = 'button';
    btn.textContent = team;
    btn.setAttribute('data-group', i);
    btn.setAttribute('data-index', idx);
    btn.setAttribute('aria-pressed','false');
    btn.addEventListener('click', onTeamClick);
    list.appendChild(btn);
  });
  return g;
}
function renderGroups(){
  groupsGrid.innerHTML = '';
  GROUPS.forEach((g, i) => groupsGrid.appendChild(createGroupEl(i, g)));
}
renderGroups();

/* Helpers */
function btnFor(groupIndex, teamIndex){
  return document.querySelector(`.team-btn[data-group="${groupIndex}"][data-index="${teamIndex}"]`);
}

/* Update UI from state */
function updateUIFromState(){
  document.querySelectorAll('.team-btn').forEach(b => b.classList.remove('selected-2','selected-3'));
  state.secondPicks.forEach((ti, g) => {
    if(ti !== null){
      const b = btnFor(g, ti);
      if(b && state.thirdPicksIndex[g] !== ti) b.classList.add('selected-2');
    }
  });
  state.thirdPicksIndex.forEach((ti,g) => {
    if(ti !== null){
      const b = btnFor(g, ti);
      if(b){ b.classList.remove('selected-2'); b.classList.add('selected-3'); }
    }
  });
}

/* Instruction helper */
function flashInstruction(msg){
  const el = document.getElementById('groupsInstruction');
  const orig = el.textContent;
  el.textContent = msg;
  el.style.color = 'white';
  setTimeout(()=>{ el.textContent = 'Pick the team you think will finish second in each group'; el.style.color='var(--cyan)'; }, 1200);
}

/* Click logic (same as before) */
function onTeamClick(e){
  const btn = e.currentTarget;
  const g = Number(btn.getAttribute('data-group'));
  const t = Number(btn.getAttribute('data-index'));

  // Stage 1: picking seconds per group
  const prev = state.secondPicks[g];
  if(prev === t){
    // deselect second
    state.secondPicks[g] = null;
    btn.classList.remove('selected-2');
    btn.setAttribute('aria-pressed','false');
  } else {
    // clear previous second in group
    if(prev !== null){
      const prevBtn = btnFor(g, prev);
      if(prevBtn){ prevBtn.classList.remove('selected-2'); prevBtn.setAttribute('aria-pressed','false'); }
    }
    // if this was a third earlier, remove it
    if(state.thirdPicksIndex[g] === t){
      state.thirdPicksIndex[g] = null;
      state.thirdCount = Math.max(0, state.thirdCount - 1);
      const wasThirdBtn = btnFor(g, t);
      if(wasThirdBtn) wasThirdBtn.classList.remove('selected-3');
    }
    state.secondPicks[g] = t;
    btn.classList.add('selected-2');
    btn.setAttribute('aria-pressed','true');
  }

  // If all 12 seconds selected, allow picking thirds (third selection via clicking teams)
  if(state.secondPicks.every(x => x !== null)){
    // remain same state: user will click to add thirds (pink). We keep state.stage=1 but enable third picking logic below:
    // For convenience we won't change stage variable; logic for third picks handled when user clicks a team that already has a second.
  }
  checkContinueEnable();
  updateUIFromState();
}

/* For picking thirds we follow the same rules as previous version:
   - If user clicks on a team in a group that already has a second, they can mark it as third (pink)
   - Only one third per group. Max 8 thirds.
   Implemented by separate click handler when all seconds selected.
*/
document.addEventListener('click', function(e){
  if(!e.target.classList.contains('team-btn')) return;
  // if user clicked a team when all seconds are set, handle third picking toggles
  if(!state.secondPicks.every(x => x !== null)) return; // only allow third picks after all seconds set
  const btn = e.target;
  const g = Number(btn.getAttribute('data-group'));
  const t = Number(btn.getAttribute('data-index'));
  const currentThird = state.thirdPicksIndex[g];

  // If clicked same as current third -> deselect third
  if(currentThird === t){
    state.thirdPicksIndex[g] = null;
    state.thirdCount = Math.max(0, state.thirdCount - 1);
    const btnCur = btnFor(g, t);
    if(btnCur) btnCur.classList.remove('selected-3');
    // if it was second, restore yellow
    if(state.secondPicks[g] === t){
      const secBtn = btnFor(g, t);
      if(secBtn) secBtn.classList.add('selected-2');
    }
    checkContinueEnable();
    updateUIFromState();
    return;
  }

  // If there's a different third in this group, clear it
  if(currentThird !== null){
    const prevThirdBtn = btnFor(g, currentThird);
    if(prevThirdBtn) prevThirdBtn.classList.remove('selected-3');
    state.thirdPicksIndex[g] = null;
    state.thirdCount = Math.max(0, state.thirdCount - 1);
  }

  // If already 8 thirds, ignore additional third selections
  if(state.thirdCount >= 8){
    flashInstruction('You already selected 8 third-place teams');
    return;
  }

  // Set this team as third for the group
  state.thirdPicksIndex[g] = t;
  state.thirdCount++;
  const clickedBtn = btnFor(g, t);
  if(clickedBtn){
    // remove yellow if it was the second
    if(state.secondPicks[g] === t){
      clickedBtn.classList.remove('selected-2');
    }
    clickedBtn.classList.add('selected-3');
    clickedBtn.setAttribute('aria-pressed','true');
  }

  checkContinueEnable();
  updateUIFromState();
});

/* Clear */
clearBtn.addEventListener('click', ()=>{
  state.secondPicks = Array(GROUPS.length).fill(null);
  state.thirdPicksIndex = Array(GROUPS.length).fill(null);
  state.thirdCount = 0;
  document.querySelectorAll('.team-btn').forEach(b=>{ b.classList.remove('selected-2','selected-3'); b.setAttribute('aria-pressed','false'); });
  comboSelect.value = "";
  goalsInput.value = "";
  checkContinueEnable();
});

/* Continue button enabling logic:
   User must have:
   - selected a combo (comboSelect)
   - filled tiebreaker (goalsInput not blank)
   - selected 12 seconds AND 8 thirds (total 20)
*/
function allSecondsSet(){ return state.secondPicks.every(x => x !== null); }
function allThirdsSelected(){ return state.thirdCount === 8; }
function picksComplete(){ return allSecondsSet() && allThirdsSelected(); }

function checkContinueEnable(){
  const comboOk = comboSelect.value && comboSelect.value !== "";
  const goalsOk = goalsInput.value !== "";
  const ready = comboOk && goalsOk && picksComplete();
  if(ready){
    continueBtn.classList.add('enabled');
    continueBtn.disabled = false;
    continueBtn.style.cursor = 'pointer';
  } else {
    continueBtn.classList.remove('enabled');
    continueBtn.disabled = true;
    continueBtn.style.cursor = 'not-allowed';
  }
}

/* Slide to account panel */
continueBtn.addEventListener('click', ()=>{
  if(!continueBtn.classList.contains('enabled')) return;
  formInner.setAttribute('data-pos','1'); // slide left to reveal right panel
  // focus username
  setTimeout(()=>nameInput.focus(), 350);
});

/* Back button */
backBtn.addEventListener('click', ()=>{
  formInner.setAttribute('data-pos','0');
});

/* Submit logic in side panel:
   Submit lights when username, email, 4-digit pin AND the picks+combo+tiebreaker complete.
*/
function inputsFilled(){
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const pin = pinInput.value.trim();
  const pinOk = /^\d{4}$/.test(pin);
  return name && email && pinOk;
}

function checkSubmitReady(){
  const ready = picksComplete() && inputsFilled();
  if(ready){
    submitBtn.classList.add('lit');
    submitBtn.disabled = false;
    submitBtn.style.cursor = 'pointer';
  } else {
    submitBtn.classList.remove('lit');
    submitBtn.disabled = true;
    submitBtn.style.cursor = 'not-allowed';
  }
}

/* Wire inputs to re-check continue and submit states */
[comboSelect, goalsInput].forEach(el=>el.addEventListener('input', ()=>{ checkContinueEnable(); checkSubmitReady(); }));
[nameInput, emailInput, pinInput].forEach(el=>el.addEventListener('input', checkSubmitReady));

/* Submit behavior: logs payload to console (you can change to POST later) */
submitBtn.addEventListener('click', ()=>{
  if(!submitBtn.classList.contains('lit')) return;
  const username = nameInput.value.trim();
  const email = emailInput.value.trim();
  const pin = pinInput.value.trim();
  const goals = goalsInput.value.trim();
  const combo = comboSelect.value;
  const seconds = state.secondPicks.map((idx, g) => ({ group: g+1, team: idx===null?null: GROUPS[g][idx] }));
  const thirds = state.thirdPicksIndex.map((idx,g) => ({ group: g+1, team: idx===null?null: GROUPS[g][idx] })).filter(x=>x.team !== null);

  const payload = { username, email, pin, goals, combo, seconds, thirds };
  console.log('SUBMIT payload', payload);

  // show brief confirmation in instruction area
  flashInstruction('SUBMITTED! THANKS');
  // optionally resetAll(); -- left commented so user stays on page
});

/* keyboard accessibility: allow Enter/Space to toggle team buttons */
document.addEventListener('keydown', (e)=>{
  if((e.key === 'Enter' || e.key === ' ') && document.activeElement && document.activeElement.classList.contains('team-btn')){
    e.preventDefault();
    document.activeElement.click();
  }
});

/* init */
updateUIFromState();
checkContinueEnable();
checkSubmitReady();
</script>
</body>
</html>
