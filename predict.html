<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Predict â€” Retro Football</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{--bg:#0A0A1A;--yellow:#FFD60A;--cyan:#00FFFF;--nav-text:var(--yellow);--nav-active-bg:var(--yellow);--nav-active-text:#0A0A1A;font-family:'Press Start 2P',monospace;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--yellow);font-family:'Press Start 2P',monospace;}
header.site-header{position:sticky;top:0;z-index:50;padding-top: 12px;}
nav.main-nav{display:flex;width:100%;justify-content:space-between;background:#0A0A1A;border-bottom:4px solid rgba(0,255,255,0.12)}
.nav-link{flex:1;text-align:center;padding:14px 0;text-decoration:none;color:var(--nav-text);border-right:1px solid rgba(0,255,255,0.06);transition:all .2s;font-size:11px;}
.nav-link:last-child{border-right:none;}
.nav-link:hover{color:var(--cyan);text-shadow:0 0 8px var(--cyan);}
.nav-link.active{background:var(--nav-active-bg);color:var(--nav-active-text);outline:3px solid var(--cyan);}
.banner{width:100%;height:160px;background-image:url('assets/predict.jpg');background-size:cover;background-position:center;margin-top:0;box-shadow:0 6px 18px rgba(0,255,255,0.1);}
main{max-width:960px;margin:24px auto;padding:12px;text-align:center;}
.pred-btn{display:inline-block;padding:16px 24px;border-radius:6px;background:var(--yellow);color:#0A0A1A;border:6px solid transparent;font-size:11px;cursor:pointer;box-shadow:0 6px 0 rgba(0,0,0,0.5),0 0 18px rgba(0,255,255,0.12);margin:6px;transition:all .15s;}
.pred-btn:hover{transform:scale(1.03);box-shadow:0 10px 30px rgba(0,255,255,0.18),inset 0 0 24px rgba(255,255,255,0.02);}
footer{border-top:4px solid rgba(0,255,255,0.06);padding:18px 0;text-align:center;}
footer a{color:var(--yellow);text-decoration:underline;font-size:11px;}

/* --- additions for predict UI --- */
.form-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));
  border:6px solid rgba(0,255,255,0.06);
  padding:14px;border-radius:10px;margin-top:16px;
}
.row{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:12px;}
.input{width:240px;display:flex;flex-direction:column;align-items:flex-start;font-size:9px;color:var(--yellow);}
.input label{font-size:10px;margin-bottom:6px;}
.input input{width:100%;padding:10px;border-radius:6px;border:4px solid rgba(0,255,255,0.06);background:transparent;color:var(--yellow);font-family:'Press Start 2P',monospace;font-size:11px;outline:none;}
.input input::placeholder{color:rgba(255,214,10,0.35);font-family:'Press Start 2P',monospace;font-size:9px}
.instruction{font-size:10px;margin:8px 0;color:var(--cyan);text-shadow:0 0 8px rgba(0,255,255,0.06);}
.controls{display:flex;justify-content:center;margin-bottom:12px;}
.button-clear{padding:10px 12px;border-radius:8px;background:transparent;border:4px solid rgba(255,214,10,0.18);font-family:'Press Start 2P',monospace;cursor:pointer;color:var(--yellow);font-size:10px;}

/* groups */
.groups-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px}
.group{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));border:4px solid rgba(0,255,255,0.04);padding:10px;border-radius:8px;min-height:120px;display:flex;flex-direction:column;align-items:center;}
.group h4{font-size:10px;margin-bottom:8px;color:var(--yellow);text-transform:uppercase;}
.team-list{display:flex;flex-direction:column;gap:8px;width:100%;}
.team-btn{font-family:'Press Start 2P',monospace;font-size:10px;padding:8px;border-radius:6px;border:3px solid rgba(0,255,255,0.04);background:transparent;color:var(--yellow);cursor:pointer;text-align:center;outline:none;transition:all .12s;box-shadow:0 6px 0 rgba(0,0,0,0.45);}
.team-btn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,255,255,0.04);color:var(--cyan)}
.team-btn.selected-2{background:var(--yellow);color:#0A0A1A;box-shadow:0 10px 30px rgba(255,214,10,0.12);border-color:rgba(255,214,10,0.7);}
.team-btn.selected-3{background:linear-gradient(90deg,#FF3CAC,#FF2FC7);color:#0A0A1A;box-shadow:0 8px 40px rgba(255,50,150,0.18);border-color:rgba(255,50,150,0.6);}

/* top text */
.top-instruction{font-size:10px;margin-bottom:6px;color:var(--yellow);}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:9999;}
.modal{background:linear-gradient(180deg, rgba(0,0,0,0.85), rgba(8,12,22,0.95)); padding:20px;border-radius:12px;border:6px solid rgba(0,255,255,0.06);width:320px;max-width:90%;}
.modal .title{font-size:12px;color:var(--yellow);margin-bottom:12px;text-align:center;}
.modal .actions{display:flex;gap:12px;justify-content:center;margin-top:12px;}
.modal .btn{padding:10px 14px;border-radius:8px;border:6px solid transparent;background:var(--yellow);cursor:pointer;font-family:'Press Start 2P',monospace;}

/* responsive */
@media(max-width:1100px){.groups-grid{grid-template-columns:repeat(4, 1fr)}}
@media(max-width:820px){.groups-grid{grid-template-columns:repeat(2, 1fr)}.input{width:100%}.row{flex-direction:column;align-items:center}}
</style>
</head>
<body>
<header class="site-header">
  <nav class="main-nav" aria-label="Main navigation">
    <a class="nav-link" href="index.html">HOME</a>
    <a class="nav-link active" href="predict.html">PREDICT</a>
    <a class="nav-link" href="standings.html">STANDINGS</a>
    <a class="nav-link" href="rules.html">RULES</a>
  </nav>
  <div class="banner"></div>
</header>

<main>
  <!-- inserted card (below banner, above privacy policy/footer) -->
  <div class="form-card" id="predictCard" role="region" aria-label="Predict form">
    <div class="top-instruction" id="topInstruction">Pick the team you think will finish second in each group</div>

    <div class="row" id="inputsRow">
      <div class="input">
        <label for="nameInput">NAME</label>
        <input id="nameInput" type="text" placeholder="YOUR NAME">
      </div>
      <div class="input">
        <label for="emailInput">EMAIL</label>
        <input id="emailInput" type="email" placeholder="EMAIL@EXAMPLE.COM">
      </div>
      <div class="input">
        <label for="pinInput">4 DIGIT PIN</label>
        <input id="pinInput" type="text" maxlength="4" inputmode="numeric" pattern="\d{4}" placeholder="1234">
      </div>
      <div class="input">
        <label for="goalsInput">How many goals will be scored in the group stage?</label>
        <input id="goalsInput" type="number" min="0" placeholder="TOTAL GOALS">
      </div>
    </div>

    <div class="instruction" id="secondaryInstruction">Pick the team you think will finish second in each group</div>

    <div class="controls">
      <button id="clearBtn" class="button-clear" title="Clear selections">CLEAR</button>
    </div>

    <div class="groups-grid" id="groupsGrid" role="list" aria-label="Groups">
      <!-- populated by JS -->
    </div>
  </div>
</main>

<footer>
  <a href="privacy.html">Privacy Policy</a>
</footer>

<!-- keep audio EXACTLY as originally supplied and behaviour to attempt autoplay -->
<audio id="bgAudio" src="assets/ko.mp3" preload="auto" playsinline autoplay loop></audio>
<script>
const audio=document.getElementById('bgAudio');
function tryPlay(){audio.play().catch(()=>{});}
window.addEventListener('load',tryPlay);
document.addEventListener('visibilitychange',()=>{if(!document.hidden){tryPlay();}});
</script>

<!-- modal markup (hidden until needed) -->
<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document">
    <div class="title">SUBMIT?</div>
    <div style="font-size:10px;color:var(--cyan);text-align:center;">Are you sure you want to submit your picks?</div>
    <div class="actions" style="margin-top:12px;">
      <button id="modalYes" class="btn">YES</button>
      <button id="modalNo" class="btn" style="background:transparent;border:6px solid rgba(255,214,10,0.18);">NO</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
   Data: the randomized 12 groups
   ------------------------- */
const GROUPS = [
  ["Norway","Ecuador","Germany","Uefa Play-off B"],    // Group 1
  ["Ghana","Saudi Arabia","South Korea","Croatia"],     // Group 2
  ["Uefa Play-off C","Curacao","Canada","Belgium"],     // Group 3
  ["Paraguay","England","Qatar","Austria"],             // Group 4
  ["South Africa","Haiti","Morocco","Switzerland"],     // Group 5
  ["United States","Uefa Play-off D","Japan","Fifa Play-off 2"], // Group 6
  ["Egypt","Argentina","Uefa Play-off A","Jordan"],     // Group 7
  ["Netherlands","Uzbekistan","Portugal","Panama"],     // Group 8
  ["Spain","Mexico","Tunisia","France"],                // Group 9
  ["Ivory Coast","New Zealand","Scotland","Cape Verde"],// Group 10
  ["Brazil","Senegal","Australia","Iran"],              // Group 11
  ["Algeria","Colombia","Fifa Play-off 1","Uruguay"]    // Group 12
];

/* -------------------------
   State
   stage:
     1 = picking second teams (must pick 1 per group)
     2 = picking eight third teams (can still re-pick seconds for groups missing a second)
   Rules implemented:
     - User picks one team per group as SECOND (yellow). When all 12 seconds set the page allows picking 8 third teams.
     - In stage 2: clicking a team in a group WITHOUT a second will set the second (yellow).
                 clicking a team in a group WITH a second will toggle that team's third selection (pink).
     - Only one third per group. Max 8 third picks total.
     - If a team is turned pink and it was yellow, the yellow visual is removed (pink dominates).
     - If a user deselects a third or second, they can re-select as needed until requirements are met.
   ------------------------- */
const state = {
  stage: 1,
  secondPicks: Array(GROUPS.length).fill(null),      // number: index 0..3 chosen as second per group
  thirdPicksIndex: Array(GROUPS.length).fill(null),  // number: index 0..3 chosen as third per group (or null)
  thirdCount: 0
};

/* -------------------------
   DOM refs
   ------------------------- */
const groupsGrid = document.getElementById('groupsGrid');
const topInstruction = document.getElementById('topInstruction');
const secondaryInstruction = document.getElementById('secondaryInstruction');
const clearBtn = document.getElementById('clearBtn');
const modalBackdrop = document.getElementById('modalBackdrop');
const modalYes = document.getElementById('modalYes');
const modalNo = document.getElementById('modalNo');

/* -------------------------
   Render groups
   ------------------------- */
function createGroupEl(i, teams){
  const g = document.createElement('div');
  g.className = 'group';
  g.setAttribute('data-group', i);
  g.innerHTML = `<h4>GROUP ${i+1}</h4><div class="team-list"></div>`;
  const list = g.querySelector('.team-list');
  teams.forEach((team, idx) => {
    const btn = document.createElement('button');
    btn.className = 'team-btn';
    btn.type = 'button';
    btn.textContent = team;
    btn.setAttribute('data-group', i);
    btn.setAttribute('data-index', idx);
    btn.setAttribute('aria-pressed','false');
    btn.addEventListener('click', onTeamClick);
    list.appendChild(btn);
  });
  return g;
}
function renderGroups(){
  groupsGrid.innerHTML = '';
  GROUPS.forEach((g, i) => groupsGrid.appendChild(createGroupEl(i, g)));
}
renderGroups();

/* -------------------------
   Helpers to get buttons
   ------------------------- */
function btnFor(groupIndex, teamIndex){
  return document.querySelector(`.team-btn[data-group="${groupIndex}"][data-index="${teamIndex}"]`);
}
function removeClassAll(selector, cls){
  document.querySelectorAll(selector).forEach(el => el.classList.remove(cls));
}

/* -------------------------
   Update instructions
   ------------------------- */
function updateInstructions(){
  if(state.stage === 1){
    topInstruction.textContent = 'Pick the team you think will finish second in each group';
    secondaryInstruction.textContent = 'Pick the team you think will finish second in each group';
    topInstruction.style.color = 'var(--yellow)';
  } else {
    topInstruction.textContent = 'Pick eight teams you think will qualify in 3rd place';
    secondaryInstruction.textContent = 'Now pick 8 teams for 3rd place (no more than one per group).';
    topInstruction.style.color = '';
  }
}

/* -------------------------
   Core click logic
   ------------------------- */
function onTeamClick(e){
  const btn = e.currentTarget;
  const g = Number(btn.getAttribute('data-group'));
  const t = Number(btn.getAttribute('data-index'));

  if(state.stage === 1){
    // Stage 1 behaviour: toggle second pick for the group
    const prev = state.secondPicks[g];
    if(prev === t){
      // deselect
      state.secondPicks[g] = null;
      btn.classList.remove('selected-2');
      btn.setAttribute('aria-pressed','false');
    } else {
      // clear previous in group
      if(prev !== null){
        const prevBtn = btnFor(g, prev);
        if(prevBtn) { prevBtn.classList.remove('selected-2'); prevBtn.setAttribute('aria-pressed','false'); }
      }
      // if this was the third selected earlier, remove third mark and decrement thirdCount
      if(state.thirdPicksIndex[g] === t){
        state.thirdPicksIndex[g] = null;
        state.thirdCount = Math.max(0, state.thirdCount - 1);
        const wasThirdBtn = btnFor(g, t);
        if(wasThirdBtn) wasThirdBtn.classList.remove('selected-3');
      }
      // set as second
      state.secondPicks[g] = t;
      btn.classList.add('selected-2');
      btn.setAttribute('aria-pressed','true');
    }

    // Check if all 12 seconds selected -> progress to stage 2
    if(state.secondPicks.every(x => x !== null)){
      state.stage = 2;
      updateInstructions();
      // No immediate UI change other than instruction; user can now pick 3rd teams
    }
    checkForSubmit();
    return;
  }

  // Stage 2 behaviour:
  // If group has no second, a click here should set the second (yellow).
  // If group already has a second, a click toggles third selection (pink) for the clicked team (one third per group).
  const hasSecond = state.secondPicks[g] !== null;

  if(!hasSecond){
    // set second for this group
    state.secondPicks[g] = t;
    // remove any conflicting third in this group (shouldn't be one but safe)
    if(state.thirdPicksIndex[g] === t){
      state.thirdPicksIndex[g] = null;
    }
    // update UI
    const btnSel = btnFor(g, t);
    if(btnSel){
      btnSel.classList.add('selected-2');
      btnSel.setAttribute('aria-pressed','true');
    }
    updateInstructions();
    checkForSubmit();
    return;
  }

  // Group has a second already -> toggle a third selection for clicked team
  const currentThird = state.thirdPicksIndex[g];
  // if clicked same as current third -> deselect third
  if(currentThird === t){
    state.thirdPicksIndex[g] = null;
    state.thirdCount = Math.max(0, state.thirdCount - 1);
    const btnCur = btnFor(g, t);
    if(btnCur) btnCur.classList.remove('selected-3');
    // if the deselected third was also the second originally, restore yellow visual
    if(state.secondPicks[g] === t){
      const secBtn = btnFor(g, t);
      if(secBtn) secBtn.classList.add('selected-2');
    }
    checkForSubmit();
    return;
  }

  // If there is a different third in this group already, clear it
  if(currentThird !== null){
    const prevThirdBtn = btnFor(g, currentThird);
    if(prevThirdBtn) prevThirdBtn.classList.remove('selected-3');
    state.thirdPicksIndex[g] = null;
    state.thirdCount = Math.max(0, state.thirdCount - 1);
  }

  // If we've already got 8 third picks, prevent more
  if(state.thirdCount >= 8){
    flashTop('You already selected 8 third-place teams');
    return;
  }

  // Make this team the third for this group
  state.thirdPicksIndex[g] = t;
  state.thirdCount++;
  const clickedBtn = btnFor(g, t);
  if(clickedBtn){
    // If this team was highlighted as second, remove second visual to show pink dominance
    if(state.secondPicks[g] === t){
      clickedBtn.classList.remove('selected-2');
    }
    clickedBtn.classList.add('selected-3');
    clickedBtn.setAttribute('aria-pressed','true');
  }

  checkForSubmit();
}

/* -------------------------
   Utility & UI helpers
   ------------------------- */
function flashTop(msg){
  const original = topInstruction.textContent;
  topInstruction.textContent = msg;
  topInstruction.style.color = 'white';
  setTimeout(()=>{ updateInstructions(); }, 1200);
}

function updateUIFromState(){
  // clear all classes
  document.querySelectorAll('.team-btn').forEach(b => b.classList.remove('selected-2','selected-3'));
  // apply seconds
  state.secondPicks.forEach((ti, g) => {
    if(ti !== null){
      const b = btnFor(g, ti);
      if(b && state.thirdPicksIndex[g] !== ti){ // don't add yellow if pink dominates
        b.classList.add('selected-2');
      }
    }
  });
  // apply thirds
  state.thirdPicksIndex.forEach((ti,g) => {
    if(ti !== null){
      const b = btnFor(g, ti);
      if(b){
        b.classList.remove('selected-2'); // pink dominates
        b.classList.add('selected-3');
      }
    }
  });
  updateInstructions();
}

/* -------------------------
   Clear / Reset
   ------------------------- */
clearBtn.addEventListener('click', resetAll);
function resetAll(){
  state.stage = 1;
  state.secondPicks = Array(GROUPS.length).fill(null);
  state.thirdPicksIndex = Array(GROUPS.length).fill(null);
  state.thirdCount = 0;
  // clear UI
  document.querySelectorAll('.team-btn').forEach(b => { b.classList.remove('selected-2','selected-3'); b.setAttribute('aria-pressed','false'); });
  // clear inputs
  document.getElementById('nameInput').value = '';
  document.getElementById('emailInput').value = '';
  document.getElementById('pinInput').value = '';
  document.getElementById('goalsInput').value = '';
  updateInstructions();
  hideModal();
}

/* -------------------------
   Submission readiness
   ------------------------- */
function allSecondsSet(){ return state.secondPicks.every(x => x !== null); }
function allThirdsSelected(){ return state.thirdCount === 8; }
function inputsFilled(){
  const name = document.getElementById('nameInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();
  const pin = document.getElementById('pinInput').value.trim();
  const goals = document.getElementById('goalsInput').value.trim();
  const pinOk = /^\d{4}$/.test(pin);
  return name && email && pinOk && goals !== '';
}

function checkForSubmit(){
  // If all seconds set, switch to stage 2 (but we allow stage2 to continue even if user later deselects some seconds)
  if(allSecondsSet()) state.stage = 2;
  updateUIFromState();

  if(allSecondsSet() && allThirdsSelected() && inputsFilled()){
    showModal();
  } else {
    hideModal();
  }
}

/* -------------------------
   Modal handling
   ------------------------- */
function showModal(){
  modalBackdrop.style.display = 'flex';
  modalBackdrop.setAttribute('aria-hidden','false');
}
function hideModal(){
  modalBackdrop.style.display = 'none';
  modalBackdrop.setAttribute('aria-hidden','true');
}
document.getElementById('modalNo').addEventListener('click', hideModal);
modalBackdrop.addEventListener('click', (e)=>{ if(e.target===modalBackdrop) hideModal(); });

document.getElementById('modalYes').addEventListener('click', ()=>{
  // gather payload
  const name = document.getElementById('nameInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();
  const pin = document.getElementById('pinInput').value.trim();
  const goals = document.getElementById('goalsInput').value.trim();

  const seconds = state.secondPicks.map((idx, g) => ({ group: g+1, team: idx===null?null: GROUPS[g][idx] }));
  const thirds = state.thirdPicksIndex.map((idx,g) => ({ group: g+1, team: idx===null?null: GROUPS[g][idx] })).filter(x=>x.team !== null);

  const payload = { name, email, pin, goals, seconds, thirds };
  console.log('SUBMIT payload', payload);

  // In production you'd POST payload to your server here.
  hideModal();
  flashTop('SUBMITTED! THANKS');
  // optionally: resetAll();
});

/* Re-check whenever inputs change */
['nameInput','emailInput','pinInput','goalsInput'].forEach(id=>{
  document.getElementById(id).addEventListener('input', checkForSubmit);
});

/* make sure keyboard Enter/Space triggers buttons */
document.addEventListener('keydown', (e)=>{
  if((e.key === 'Enter' || e.key === ' ') && document.activeElement && document.activeElement.classList.contains('team-btn')){
    e.preventDefault();
    document.activeElement.click();
  }
});

/* initial UI */
updateInstructions();
resetAll();
</script>

</body>
</html>
